<!DOCTYPE html>
<html lang="en-us">
    <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Tomas Vitvar">
<meta name="description" content="well-oiled machine">
<meta name="generator" content="Hugo 0.55.6" />
<title>vitvar.com &middot; vitvar.com</title>
<link rel="shortcut icon" href="/images/favicon.ico">


<link rel="stylesheet" href="/css/style.min.css" integrity="">




<link href="/index.xml" rel="alternate" type="application/rss+xml" title="vitvar.com" />


<link rel="alternate" type="application/json" href="/index.json">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>


    </head>
<body>
    <nav>
	<section class="container">
	<div class="logo">
		<a  href="https://vitvar.com"> <h1 class="brand">vitvar.com</h1> </a>
		<div class="subtitle">
		<span>well-oiled machine</span>
		</div>
	</div>
	<ul class="navigation-list">
		
		
			<li class=""><a  href='/about/'>About</a></li>
		
			<li class=""><a  href='/lectures/'>Lectures</a></li>
		
			<li class=""><a  href='/post/'>Posts</a></li>
		
	</ul>
	</section>
</nav>

    <section id="wrapper">
        
        
	
		<article class="post">
    <header>
        <span class="title">Service Outbound Call and DNS Resolver Timeout</span>
        <span class="published">
        June 25, 2019
        </span>
    </header>
    <section id="post-body">
        <p>In order to maintain your integration platform&rsquo;s resilience, you should have timeouts on your services&rsquo; outbound calls. When you do, any long running outbound service call won&rsquo;t block your threads. And it is important to have enough threads in your thread pool at any point in time as otherwise your integration middleware may be blocked and process no requests. These are obviously caveats of blocking I/O, when your integration middleware uses asynchronous (non-blocking) calls, the situation is different.</p>

<p>You should be able to set two kinds of timeouts on your outbound HTTP service calls, namely <strong><em>HTTP connect timeout</em></strong> and <strong><em>HTTP read timeout</em></strong>. When your service&rsquo;s endpoint contains a hostname, a time to resolve the hostname to an IP address counts against the HTTP connect timeout. Operating system usually has two DNS servers configured in <code>/etc/resolv.conf</code>, one primary and one secondary. The secondary server is a failover server when a name resolution request to the primary fails or timeouts. However, most of <code>resolv.conf</code> configurations do not define timeouts to failover to the secondary server, which may cause problems in upper layers of the stack.</p>

<p>Consider the following scenario:</p>

<ol>
<li><p>There is a HTTP connect timeout towards a downstream service endpoint which is set to 5 seconds.</p></li>

<li><p>Your server tries to establish a connection with a hostname from your downstream service&rsquo;s endpoint. The server tries to resolve the hostname to an IP address by calling the resolver.</p></li>

<li><p>When the primary server is down, the resolver will failover to the secondary one as per the timeout and a number of attempts configuration. As there is no explicit setting, the resolver will use <a href="http://man7.org/linux/man-pages/man5/resolver.5.html">default values of 5 seconds and 2 attempts</a>. A single hostname resolution will thus take at least 10 seconds.</p></li>

<li><p>Since the connect timeout of 5 seconds is less than the failover timeout of 10 seconds, the call to the downstream service will fail on connect timeout.</p></li>
</ol>

<p>You will most likely only see a connect timeout message in your server logs leaving you with your full stack investigation to understand the root cause of this issue.</p>

    </section>
</article>



<div id="disqus_thread"></div>
<a id="show-disqus" style="padding-top: -100px" href="#">show comments</a> 

<script type="text/javascript">
  $("#show-disqus").click((e)=>{
    e.preventDefault();
    $("#show-disqus").remove();
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'blog-tvitvar';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $("#disqus_thread").css('display', 'block');  
  })
</script>




	


        <footer id="footer">
    <section class="container">
      <div>
        <p class="small">
        Except where otherwise noted, content on this site is licensed under
        Creative Commons Attribution-ShareAlike 4.0 License.
        </p>
      </div>
      <div class="links">
        <a href="/index.xml"><div class="icon-feed">&nbsp;</div></a>
        <a href="https://cz.linkedin.com/in/vitvar"><div class="icon-linkedin">&nbsp;</div></a>
        <a href="https://twitter.com/tomasvitvar"><div class="icon-twitter">&nbsp;</div></a>
        <a href="https://github.com/tomvit"><div class="icon-github">&nbsp;</div></a>
      </div>
    </section>
</footer>
    </section>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-396530-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


</body>
</html>
